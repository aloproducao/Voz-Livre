<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mesa de Luz para Desenho</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.3/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
      body {
        background-color: #ffffff;
      }

      #imagem {
        max-height: 80vh;
        max-width: 80vw;
        transform-origin: center;
        cursor: move;
        position: relative;
      }

      .locked {
        pointer-events: none;
      }
    </style>
  </head>

  <body
    class="flex flex-col items-center justify-center h-screen overflow-hidden"
  >
  <div class="w-full p-2 md:p-4 bg-neutral fixed top-0 left-0 flex flex-wrap justify-between items-center z-10">
    <div class="mb-2 md:mb-0">
        <label for="fileInput" class="btn btn-outline btn-warning text-white p-1 rounded cursor-pointer">
            Carregar Imagem
        </label>
        <input type="file" id="fileInput" class="hidden" />
        
    </div>
    <div class="flex items-center flex-wrap space-x-2">
        <div class="flex items-center mb-2 md:mb-0 space-x-2">
            <button id="btnTelaCheia" class="btn btn-outline btn-accent p-1 rounded text-white mb-2 md:mb-0">Tela Cheia</button>
            <label for="zoomRange" class="text-white">Zoom:</label>
            <input type="range" id="zoomRange" min="1" max="3" step="0.01" value="1" class="mr-2">
        </div>
      
        <div class="flex items-center mb-2 md:mb-0 space-x-2">
            <label for="opacityRange" class="text-white">Opacidade:</label>
            <input type="range" id="opacityRange" min="0" max="1" step="0.01" value="0.5">
        </div>
        <button id="btnLimparDB" class="btn btn-outline btn-error p-1 rounded text-white mb-2 md:mb-0">Limpar Imagem</button>
        <button id="btnInverter" class="bg-neutral-focus text-white p-1 rounded mb-2 md:mb-0">Inverter</button>
        <button id="btnTrancar" class="bg-neutral-focus p-1 rounded mb-2 md:mb-0" style="font-size: 2remtat;">ðŸ”’</button>
    </div>
</div>

    <div
      class="mt-20 relative w-full h-full flex items-center justify-center"
      id="imageContainer"
    >
      <img
        id="imagem"
        src="tatu.png"
        alt="Imagem para desenho"
        draggable="false"
      />
    </div>
    <script>
      const imagem = document.getElementById("imagem");
      const btnLimparDB = document.getElementById("btnLimparDB");
      const imageContainer = document.getElementById("imageContainer");
      const zoomRange = document.getElementById("zoomRange");
      const opacityRange = document.getElementById("opacityRange");
      const btnInverter = document.getElementById("btnInverter");
      const btnTrancar = document.getElementById("btnTrancar");
      const fileInput = document.getElementById("fileInput");
      // Configurando IndexedDB
      let db;
      const request = indexedDB.open("MesaDeLuzDB", 1);
      request.onupgradeneeded = function (event) {
        db = event.target.result;
        let objectStore = db.createObjectStore("imagens", { keyPath: "id" });
        objectStore.createIndex("imagem", "imagem", { unique: false });
      };

      request.onsuccess = function (event) {
        db = event.target.result;
        carregarImagemDoDB();
      };

      function carregarImagemDoDB() {
        const transaction = db.transaction(["imagens"]);
        const objectStore = transaction.objectStore("imagens");
        const request = objectStore.get(1);
        request.onsuccess = function (event) {
          if (request.result) {
            imagem.src = request.result.imagem;
          }
        };
      }

      fileInput.addEventListener("change", function () {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (event) {
            const transaction = db.transaction(["imagens"], "readwrite");
            const objectStore = transaction.objectStore("imagens");
            objectStore.put({ id: 1, imagem: event.target.result });
            imagem.src = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      zoomRange.addEventListener("input", function () {
        imagem.style.transform = `scale(${this.value})`;
      });

      opacityRange.addEventListener("input", function () {
        imagem.style.opacity = this.value;
      });

      btnInverter.addEventListener("click", () => {
        if (imagem.style.transform.includes("scaleX(-1)")) {
          imagem.style.transform = imagem.style.transform.replace(
            "scaleX(-1)",
            "scaleX(1)"
          );
        } else {
          imagem.style.transform = `scaleX(-1) ${imagem.style.transform}`;
        }
      });

      let initialTouchX, initialTouchY;

imagem.addEventListener('touchstart', function(event) {
    if (!imagem.classList.contains('locked')) {
        isMoving = true;
        initialTouchX = event.touches[0].clientX - offsetX;
        initialTouchY = event.touches[0].clientY - offsetY;
    }
}, { passive: true });

document.addEventListener('touchmove', function(event) {
    if (isMoving) {
        offsetX = event.touches[0].clientX - initialTouchX;
        offsetY = event.touches[0].clientY - initialTouchY;
        imagem.style.left = offsetX + 'px';
        imagem.style.top = offsetY + 'px';
    }
}, { passive: true });

document.addEventListener('touchend', function() {
    isMoving = false;
});


      let isMoving = false;
      let initialX,
        initialY,
        offsetX = 0,
        offsetY = 0;

      imagem.addEventListener("mousedown", function (event) {
        if (!imagem.classList.contains("locked")) {
          isMoving = true;
          initialX = event.clientX - offsetX;
          initialY = event.clientY - offsetY;
        }
      });

      btnLimparDB.addEventListener('click', function() {
            const transaction = db.transaction(["imagens"], "readwrite");
            const objectStore = transaction.objectStore("imagens");
            const request = objectStore.clear(); // Limpa todos os dados do object store

            request.onsuccess = function() {
                alert('Imagem removida com sucesso!');
                imagem.src = "tatu.png"; // Resetando para a imagem padrÃ£o
            };

            request.onerror = function() {
                alert('Erro ao remover imagem.');
            };
        });
        const btnTelaCheia = document.getElementById('btnTelaCheia');

btnTelaCheia.addEventListener('click', function() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }
    }
});

      document.addEventListener("mousemove", function (event) {
        if (isMoving) {
          offsetX = event.clientX - initialX;
          offsetY = event.clientY - initialY;
          imagem.style.left = offsetX + "px";
          imagem.style.top = offsetY + "px";
        }
      });

      document.addEventListener("mouseup", function () {
        isMoving = false;
      });

      btnTrancar.addEventListener("click", () => {
        if (imagem.classList.contains("locked")) {
          imagem.classList.remove("locked");
          alert("Movimentos e cliques desbloqueados!");
        } else {
          imagem.classList.add("locked");
          alert("Movimentos e cliques bloqueados!");
        }
      });

      document.body.addEventListener('touchmove', function(event) {
            if (imagem.classList.contains("locked")) {
                event.preventDefault();
            }
        }, { passive: false });
    </script>
  </body>
</html>
